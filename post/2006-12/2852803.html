<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>Tomcat 5 JNDI DataSource를 통한 DB 커넥션 풀 사용</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">권남</strong> 님 (<strong class="name">kwon37xi</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2006-12-03 12:12:26</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">Tomcat 5 JNDI DataSource를 통한 DB 커넥션 풀 사용</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">이미 눈치 채셨겠지만, 요즘 내가 RDBMS 배우기에 열을 올리고 있다.<br>지금까지는 JSP/Servlet에서 직접 커넥션을 맺거나, 웹 컨텍스트내에 커넥션 풀 라이브러리를 두고 호출에서 사용했는데, 좀 바꿔야겠다.<br>JNDI를 통한 커넥션 풀 사용은 J2EE 표준이고, 현존하는 거의 모든 웹 컨테이너가 지원한다고 한다.<br><br>JNDI를 서버에 설정하는 방법은 각 WAS 별로 다르지만, 사용하는 것은 모두 동일하므로 호환성에 문제도 없다.<br><br>이 글은 <a title="" href="http://jakarta.apache.org/">Jakarta의 DBCP 커넥션 풀</a>과 Tomcat JNDI 설정을 통해 데이터베이스 커넥션 풀을 사용하는 방법이다.<br><br>JNDI와 커넥션 풀에 관한 자세한 설명이 JavaServer Pages 3rd ed.에 실려있다. 이 책 너무 좋다. 꼭 읽어보라고 강력하게 권하고 싶다.<br><br>&nbsp;* 참조 URL : <a title="" href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-datasource-examples-howto.html">http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-datasource-examples-howto.html</a><br>이 글은 사실상 저 참조 URL의 번역에 가깝다.<br>&nbsp;* Tomcat Admin을 이용한 DataSource 설정 : <a title="" href="http://www.okjsp.pe.kr/lecture/viewlet/okjsp2005/05_webdev_datasource.html">http://www.okjsp.pe.kr/lecture/viewlet/okjsp2005/05_webdev_datasource.html</a><br><br><div class="h2">기본적으로 필요한 라이브러리</div><br>&nbsp;* commons-dbcp.jar<br>&nbsp;* commons-collections.jar<br>&nbsp;* commons-pool.jar<br><br><div class="h2">예제 JDBC 드라이버</div><br>&nbsp;* Oracle 9i classes12.jar<br><br><div class="h2">JNDI Naming Resource 설정</div><br>1.  위 라이브러리들을 <strong>$CATALINA_HOME/common/lib</strong> 에 복사한다. 그 이외 디렉토리에 두면 안된다. ZIP 파일은 JAR로 확장자를 바꿔야 한다. 톰캣은 JAR파일만 클래스패스에 추가한다.<br><br>2. Connection 풀을 이용할 경우에는 <strong>ResultSet과 Connection 객체를 필히 직접 닫아 줘야만 한다.</strong><br><br>3. <strong>$CATALINA_HOME/conf/server.xml</strong> 혹은 각 웹 컨텍스트별 XML 파일의 <strong>&lt;Context&gt;</strong>의 자식 요소로 다음을 추가한다.<br><blockquote class="src" style="height: 250px;">&nbsp;&nbsp;&lt;Resource&nbsp;name="jdbc/forumDb"&nbsp;auth="Container"&nbsp;type="javax.sql.DataSource"/&gt;<br>&nbsp;&nbsp;&lt;!--&nbsp;Resource의&nbsp;name&nbsp;속성을&nbsp;이용해서&nbsp;각&nbsp;어플리케이션에서<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javax.sql.DataSource&nbsp;객체를&nbsp;얻어가게&nbsp;된다.&nbsp;--&gt;<br><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;&lt;!--&nbsp;자세한&nbsp;파라미터&nbsp;설정은<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-datasource-examples-howto.html&nbsp;참조&nbsp;--&gt;<br>&nbsp;&nbsp;&lt;ResourceParams&nbsp;name="jdbc/forumDb"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;factory&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;maxActive&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;100&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;maxIdle&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;30&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;maxWait&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;10000&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;DB&nbsp;사용자명과&nbsp;비밀번호&nbsp;설정&nbsp;--&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;username&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;dbuser&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;password&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;dbpasswd&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;JDBC&nbsp;드라이버&nbsp;클래스&nbsp;--&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;driverClassName&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;oracle.jdbc.driver.OracleDriver&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;JDBC&nbsp;접속&nbsp;URL&nbsp;--&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;url&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;jdbc:oracle:thin:@dbhost:1521:ORA&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;커넥션에&nbsp;문제&nbsp;없는지&nbsp;테스트하는&nbsp;쿼리&nbsp;--&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;validationQuery&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;select&nbsp;sysdate&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br>&nbsp;&nbsp;&lt;/ResourceParams&gt;<br></blockquote><br>&nbsp;4웹 어플리케이션의 web.xml파일에 다음을 추가하여 JNDI 리소스를 사용할 수 있도록 한다.<br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;&lt;resource-ref&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;Forum&nbsp;DB&nbsp;Connection&lt;/description&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;다음이&nbsp;바로&nbsp;리소스의&nbsp;이름&nbsp;--&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;res-ref-name&gt;jdbc/forumDb&lt;/res-ref-name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;res-auth&gt;Container&lt;/res-auth&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/resource-ref&gt;<br></blockquote><br><div class="h2">JSP/Servlet 에서 사용하기</div><br>이제 다음과 같이 JNDI를 이용해 DataSource 객체를 얻고, 그 객체에서 커넥션을 얻어오면 된다.<br><br>다음은 서블릿을 작성하고, 그 서블릿에서 DB커넥션을 얻고, 쿼리를 날린 뒤, 그 결과를 JSP 파일에 포워딩하여 JSTL을 이용해 출력하는 것이다.<br>&nbsp;1. 예제 테이블과 데이터 SQL - 오라클 계정으로 다음과 같은 데이터를 생성했다고 가정하면<br><blockquote class="src">create&nbsp;table&nbsp;test&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;num&nbsp;NUMBER&nbsp;NOT&nbsp;NULL,<br>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;VARCHAR2(16)&nbsp;NOT&nbsp;NULL<br>);<br><br>truncate&nbsp;table&nbsp;test;<br><br>insert&nbsp;into&nbsp;test&nbsp;values(1,'영희');<br>insert&nbsp;into&nbsp;test&nbsp;values(2,&nbsp;'철수');<br>insert&nbsp;into&nbsp;test&nbsp;values(3,&nbsp;'미숙');<br>commit;<br></blockquote><br>&nbsp;2. test.JndiDataSourceTestServlet 소스<br><blockquote class="src" style="height: 250px;">package&nbsp;test;<br><br>import&nbsp;java.io.IOException;<br>import&nbsp;java.sql.Connection;<br>import&nbsp;java.sql.ResultSet;<br>import&nbsp;java.sql.SQLException;<br>import&nbsp;java.sql.Statement;<br>import&nbsp;java.util.ArrayList;<br>import&nbsp;java.util.HashMap;<br>import&nbsp;java.util.List;<br>import&nbsp;java.util.Map;<br><br>import&nbsp;javax.naming.Context;<br>import&nbsp;javax.naming.InitialContext;<br>import&nbsp;javax.naming.NamingException;<br>import&nbsp;javax.servlet.RequestDispatcher;<br>import&nbsp;javax.servlet.ServletException;<br>import&nbsp;javax.servlet.http.HttpServlet;<br>import&nbsp;javax.servlet.http.HttpServletRequest;<br>import&nbsp;javax.servlet.http.HttpServletResponse;<br>import&nbsp;javax.sql.DataSource;<br><br>public&nbsp;class&nbsp;JndiDataSourceTestServlet&nbsp;extends&nbsp;HttpServlet&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;doGet(HttpServletRequest&nbsp;request,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse&nbsp;response)&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connection&nbsp;conn&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResultSet&nbsp;rs&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statement&nbsp;stmt&nbsp;=&nbsp;null;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;커넥션을&nbsp;얻기&nbsp;위한&nbsp;전초작업.&nbsp;이&nbsp;부분을&nbsp;메소드화&nbsp;하면&nbsp;되겠다.&nbsp;------------<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Context&nbsp;initContext&nbsp;=&nbsp;new&nbsp;InitialContext();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Context&nbsp;envContext&nbsp;=&nbsp;(Context)initContext.lookup("java:/comp/env");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataSource&nbsp;ds&nbsp;=&nbsp;(DataSource)envContext.lookup("jdbc/forumDb");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;커넥션&nbsp;얻기<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn&nbsp;=&nbsp;ds.getConnection();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//------------------------------------------------------------------<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;sql&nbsp;=&nbsp;"SELECT&nbsp;*&nbsp;from&nbsp;test";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stmt&nbsp;=&nbsp;conn.createStatement();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs&nbsp;=&nbsp;stmt.executeQuery(sql);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;results&nbsp;=&nbsp;new&nbsp;ArrayList();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(rs.next())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;row&nbsp;=&nbsp;new&nbsp;HashMap();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.put("num",&nbsp;rs.getString("num"));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.put("name",&nbsp;rs.getString("name"));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;results.add(row);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setAttribute("results",&nbsp;results);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RequestDispatcher&nbsp;rd&nbsp;=&nbsp;request.getRequestDispatcher("/dbtest.jsp");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rd.forward(request,&nbsp;response);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(NamingException&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException("JNDI&nbsp;부분&nbsp;오류",&nbsp;e);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServletException("뭔가&nbsp;다른&nbsp;부분&nbsp;오류",&nbsp;e);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;리소스를&nbsp;필히&nbsp;반환할&nbsp;것!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rs&nbsp;!=&nbsp;null)&nbsp;{&nbsp;try&nbsp;{&nbsp;rs.close();&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ignored)&nbsp;{}&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(stmt&nbsp;!=&nbsp;null)&nbsp;{&nbsp;try&nbsp;{&nbsp;stmt.close();&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ignored)&nbsp;{}&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(conn&nbsp;!=&nbsp;null)&nbsp;{&nbsp;try&nbsp;{&nbsp;conn.close();&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ignored)&nbsp;{}&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></blockquote><br>&nbsp;3. web.xml에 서블릿 등록<br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;dbtest.svl&lt;/servlet-name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-class&gt;test.JndiDataSourceTestServlet&lt;/servlet-class&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/servlet&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-mapping&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;dbtest.svl&lt;/servlet-name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/dbtest.svl&lt;/url-pattern&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/servlet-mapping&gt;<br></blockquote><br>&nbsp;4. /dbtest.jsp 소스<br><blockquote class="src">&lt;%@&nbsp;page&nbsp;contentType="text/html"&nbsp;pageEncoding="EUC-KR"&nbsp;%&gt;<br>&lt;%@&nbsp;taglib&nbsp;uri="http://java.sun.com/jsp/jstl/core"&nbsp;prefix="c"&nbsp;%&gt;<br>&lt;%@&nbsp;taglib&nbsp;uri="http://java.sun.com/jsp/jstl/sql"&nbsp;prefix="sql"&nbsp;%&gt;<br><br>&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;"-//w3c//dtd&nbsp;html&nbsp;4.0&nbsp;transitional//en"&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;JNDI&nbsp;DataSource&nbsp;Test&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&nbsp;bgcolor="#FFFFFF"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;h2&gt;Results&lt;/h2&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:forEach&nbsp;var="row"&nbsp;items="${results}"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUM&nbsp;:&nbsp;${row.num}&lt;br&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;:&nbsp;${row.name}&lt;br&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;hr&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:forEach&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></blockquote><br>5. 이제 웹 브라우저에서 "/dbtest.svl" 을 호출해보면 결과를 볼 수 있다.<br><br><div class="h2"> 전역적인" jndi 리소스 이용</div><br>&lt;Resource&gt;와 &lt;ResourceParams&gt; 요소를 server.xml의 &lt;GlobalNamingResources&gt; 의 자식노드로 옮기면 특정 웹 어플리케이션이 아니라, 이 톰캣에 설치된 전체 웹 어플리케이션에서 사용 할 수 있게 된다. 하지만 각 웹 어플리케이션 "&lt;Context&gt;"에 다음과 같은 설정을 해야 한다.<br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;&lt;ResourceLink&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name="jdbc/forumDb"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global="jdbc/forumDb"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="javax.sql.DataSource"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br></blockquote><br>아니면 server.xml에서 &lt;Host&gt; 요소의 자식으로 다음을 추가하면 각 컨텍스트별 설정 필요없이 전체 웹 어플리케이션 컨텍스트에서 GlobalNamingResources로 지정된 JNDI 리소스를 사용할 수 있다.<br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;&lt;DefaultContext&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ResourceLink&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name="jdbc/forumDb"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global="jdbc/forumDb"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="javax.sql.DataSource"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/DefaultContext&gt;<br></blockquote><br><div class="h2">문제가 생겼어요!</div><br><div class="h3">&nbsp;1.DB 커넥션이 간혹 끊어져요.</div><br>Tomcat이 작동중인 JVM이 가비지 컬렉션을 할 때, 그 시간이 JNDI Resource에 파라미터로 설정한 maxWait보다 길게 갈 경우 DB 커넥션이 끊어질 수 있다.<br><strong>CATALINA_OPTS=-verbose:gc</strong> 옵션을 주면 <strong>$CATALINA_HOME/logs/catalina.out</strong>에 가비지 컬렉션 상황이 기록된다. 거기에 GC 작업에 걸린 시간도 나오니 그것을 참조로 maxWait 파라미터를 늘려주면 된다. 보통 10~15초로 주면 된다.<br>GC 시간은 거의 99% 이상 1초 이내에 끝나야 하나보다..<br><br><div class="h3">&nbsp;2. 무작위로 커넥션이 close 되요.</div><br>그건.. Connection 객체를 두 번 이상 close 했기 때문이다.<br>DB Connection Pool은 close()를 호출할 때 정말로 닫는 것이 아니라, 단지 재사용할 수 있다고 표시만 할 뿐이다.<br>커넥션을 사용하다가 close()하면 다른 쓰레드이서 이 커넥션을 쓸 수 있는데, 이걸 현재 쓰레드에서 계속 잡고 있다가 또 다시 close()를 해버리면, 다른 쓰레드에서 사용중에 close()됐다고 나와 버리게 되는 거다.<br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;conn.close();<br>&nbsp;&nbsp;&nbsp;&nbsp;conn&nbsp;=&nbsp;null;<br></blockquote><br>위와 같이 커넥션을 close()한 뒤에 바로 null 로 설정하여 절대로 다시 사용할 수 없게 만들면 이런 실수는 생기지 않을 것이다.<br><br><div class="h2">Tomcat 5.5 예제</div><br><blockquote class="src">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Resource&nbsp;name="jdbc/myDbResource"&nbsp;auth="Container"&nbsp;type="javax.sql.DataSource"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxActive="10"&nbsp;maxIdle="5"&nbsp;maxWait="10000"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username="ao"&nbsp;password="ao"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;driverClassName="com.mysql.jdbc.Driver"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url="jdbc:mysql://localhost:3306/myWebApp"<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeAbandoned="true"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeAbandonedTimeout="60"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logAbandoned="true"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validationQuery="select&nbsp;1"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testOnBorrow="true"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testWhileIdle="true"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeBetweenEvictionRunsMillis="10000"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minEvictableIdleTimeMillis="60000"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br></blockquote><br>저기서 <strong>removeAbandoned</strong>는 리소스 반환에 실패한 (혹은 안한) 커넥션을 자동으로 닫아주는 것이다.<br><br><strong>validationQuery</strong>는 커넥션이 살아 있는지 테스트하는 코드이다.<br><br><div class="h2">MySQL, Connector/J 와 Tomcat 5 예제</div><br><a title="" href="http://dev.mysql.com/doc/connector/j/en/cj-tomcat-config.html">http://dev.mysql.com/doc/connector/j/en/cj-tomcat-config.html</a> 에 나온 내용임.<br><blockquote class="src" style="height: 250px;">&lt;Context&nbsp;....&gt;<br><br>&nbsp;&nbsp;...<br><br>&nbsp;&nbsp;&lt;Resource&nbsp;name="jdbc/MySQLDB"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth="Container"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type="javax.sql.DataSource"/&gt;<br><br>&nbsp;&nbsp;&lt;!--&nbsp;The&nbsp;name&nbsp;you&nbsp;used&nbsp;above,&nbsp;must&nbsp;match&nbsp;_exactly_&nbsp;here!<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;connection&nbsp;pool&nbsp;will&nbsp;be&nbsp;bound&nbsp;into&nbsp;JNDI&nbsp;with&nbsp;the&nbsp;name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"java:/comp/env/jdbc/MySQLDB"<br>&nbsp;&nbsp;--&gt;<br><br>&nbsp;&nbsp;&lt;ResourceParams&nbsp;name="jdbc/MySQLDB"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;factory&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Don't&nbsp;set&nbsp;this&nbsp;any&nbsp;higher&nbsp;than&nbsp;max_connections&nbsp;on&nbsp;your<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MySQL&nbsp;server,&nbsp;usually&nbsp;this&nbsp;should&nbsp;be&nbsp;a&nbsp;10&nbsp;or&nbsp;a&nbsp;few&nbsp;10's<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;connections,&nbsp;not&nbsp;hundreds&nbsp;or&nbsp;thousands&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;maxActive&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;10&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;You&nbsp;don't&nbsp;want&nbsp;to&nbsp;many&nbsp;idle&nbsp;connections&nbsp;hanging&nbsp;around<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;you&nbsp;can&nbsp;avoid&nbsp;it,&nbsp;only&nbsp;enough&nbsp;to&nbsp;soak&nbsp;up&nbsp;a&nbsp;spike&nbsp;in<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;load&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;maxIdle&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;5&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Don't&nbsp;use&nbsp;autoReconnect=true,&nbsp;it's&nbsp;going&nbsp;away&nbsp;eventually<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;it's&nbsp;a&nbsp;crutch&nbsp;for&nbsp;older&nbsp;connection&nbsp;pools&nbsp;that&nbsp;couldn't<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test&nbsp;connections.&nbsp;You&nbsp;need&nbsp;to&nbsp;decide&nbsp;if&nbsp;your&nbsp;application&nbsp;is<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;supposed&nbsp;to&nbsp;deal&nbsp;with&nbsp;SQLExceptions&nbsp;(hint,&nbsp;it&nbsp;should),&nbsp;and<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;how&nbsp;much&nbsp;of&nbsp;a&nbsp;performance&nbsp;penalty&nbsp;you're&nbsp;willing&nbsp;to&nbsp;pay<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;ensure&nbsp;'freshness'&nbsp;of&nbsp;the&nbsp;connection&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;validationQuery&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;SELECT&nbsp;1&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;The&nbsp;most&nbsp;conservative&nbsp;approach&nbsp;is&nbsp;to&nbsp;test&nbsp;connections<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;before&nbsp;they're&nbsp;given&nbsp;to&nbsp;your&nbsp;application.&nbsp;For&nbsp;most&nbsp;applications<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;okay,&nbsp;the&nbsp;query&nbsp;used&nbsp;above&nbsp;is&nbsp;very&nbsp;small&nbsp;and&nbsp;takes<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;real&nbsp;server&nbsp;resources&nbsp;to&nbsp;process,&nbsp;other&nbsp;than&nbsp;the&nbsp;time&nbsp;used<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;traverse&nbsp;the&nbsp;network.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;you&nbsp;have&nbsp;a&nbsp;high-load&nbsp;application&nbsp;you'll&nbsp;need&nbsp;to&nbsp;rely&nbsp;on<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;something&nbsp;else.&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;testOnBorrow&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;true&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Otherwise,&nbsp;or&nbsp;in&nbsp;addition&nbsp;to&nbsp;testOnBorrow,&nbsp;you&nbsp;can&nbsp;test<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;connections&nbsp;are&nbsp;sitting&nbsp;idle&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;testWhileIdle&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;true&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;You&nbsp;have&nbsp;to&nbsp;set&nbsp;this&nbsp;value,&nbsp;otherwise&nbsp;even&nbsp;though<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you've&nbsp;asked&nbsp;connections&nbsp;to&nbsp;be&nbsp;tested&nbsp;while&nbsp;idle,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;idle&nbsp;evicter&nbsp;thread&nbsp;will&nbsp;never&nbsp;run&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;timeBetweenEvictionRunsMillis&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;10000&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Don't&nbsp;allow&nbsp;connections&nbsp;to&nbsp;hang&nbsp;out&nbsp;idle&nbsp;too&nbsp;long,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;never&nbsp;longer&nbsp;than&nbsp;what&nbsp;wait_timeout&nbsp;is&nbsp;set&nbsp;to&nbsp;on&nbsp;the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server...A&nbsp;few&nbsp;minutes&nbsp;or&nbsp;even&nbsp;fraction&nbsp;of&nbsp;a&nbsp;minute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;sometimes&nbsp;okay&nbsp;here,&nbsp;it&nbsp;depends&nbsp;on&nbsp;your&nbsp;application<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;how&nbsp;much&nbsp;spikey&nbsp;load&nbsp;it&nbsp;will&nbsp;see&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;minEvictableIdleTimeMillis&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;60000&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Username&nbsp;and&nbsp;password&nbsp;used&nbsp;when&nbsp;connecting&nbsp;to&nbsp;MySQL&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;username&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;someuser&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;password&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;somepass&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Class&nbsp;name&nbsp;for&nbsp;the&nbsp;Connector/J&nbsp;driver&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;driverClassName&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;The&nbsp;JDBC&nbsp;connection&nbsp;url&nbsp;for&nbsp;connecting&nbsp;to&nbsp;MySQL,&nbsp;notice<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;pass&nbsp;any&nbsp;other&nbsp;MySQL-specific&nbsp;parameters<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you&nbsp;should&nbsp;pass&nbsp;them&nbsp;here&nbsp;in&nbsp;the&nbsp;URL,&nbsp;setting&nbsp;them&nbsp;using&nbsp;the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter&nbsp;tags&nbsp;above&nbsp;will&nbsp;have&nbsp;no&nbsp;effect,&nbsp;you&nbsp;will&nbsp;also<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;to&nbsp;use&nbsp;&amp;&nbsp;to&nbsp;separate&nbsp;parameter&nbsp;values&nbsp;as&nbsp;the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ampersand&nbsp;is&nbsp;a&nbsp;reserved&nbsp;character&nbsp;in&nbsp;XML&nbsp;--&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;url&lt;/name&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;jdbc:mysql://localhost:3306/test&lt;/value&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/parameter&gt;<br><br>&nbsp;&nbsp;&lt;/ResourceParams&gt;<br>&lt;/Context&gt;<br></blockquote><br><br><div class="h2">Oracle 만을 위한 JNDI 설정</div><br>원문 : <a title="" href="http://www.microdeveloper.com/html/JNDI_Orcl_Tomcat1p.html">http://www.microdeveloper.com/html/JNDI_Orcl_Tomcat1p.html</a><br><br>1) Modify the server.xml file<br>In &lt;CATALINA_HOME&gt;/conf/server.xml between &lt;GlobalNamingResources&gt; and &lt;/GlobalNamingResources&gt; add the following<br><blockquote class="src">&lt;Resource&nbsp;name="jdbc/&lt;alias&gt;"<br>&nbsp;&nbsp;&nbsp;auth="Container"<br>&nbsp;&nbsp;&nbsp;type="oracle.jdbc.pool.OracleDataSource"<br>&nbsp;&nbsp;&nbsp;driverClassName="oracle.jdbc.driver.OracleDriver"<br>&nbsp;&nbsp;&nbsp;factory="oracle.jdbc.pool.OracleDataSourceFactory"<br>&nbsp;&nbsp;&nbsp;url="jdbc:oracle:thin:@&lt;host&gt;:&lt;port&gt;:&lt;sid&gt;"<br>&nbsp;&nbsp;&nbsp;[user=&lt;user&gt;]<br>&nbsp;&nbsp;&nbsp;[password=&lt;password&gt;]<br>&nbsp;&nbsp;&nbsp;maxActive="20"<br>&nbsp;&nbsp;&nbsp;maxIdle="10"<br>&nbsp;&nbsp;&nbsp;maxWait="-1"&nbsp;/&gt;<br></blockquote><br>Example<br><blockquote class="src" style="height: 250px;">&lt;!--&nbsp;Global&nbsp;JNDI&nbsp;resources&nbsp;--&gt;<br>&nbsp;&lt;GlobalNamingResources&gt;<br><br>&nbsp;&lt;!--&nbsp;Test&nbsp;entry&nbsp;for&nbsp;demonstration&nbsp;purposes&nbsp;--&gt;<br>&nbsp;&lt;Environment&nbsp;name="simpleValue"&nbsp;type="java.lang.Integer"&nbsp;value="30"/&gt;<br><br>&nbsp;&lt;!--&nbsp;Editable&nbsp;user&nbsp;database&nbsp;that&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;by<br>&nbsp;&nbsp;&nbsp;UserDatabaseRealm&nbsp;to&nbsp;authenticate&nbsp;users&nbsp;--&gt;<br>&nbsp;&lt;Resource&nbsp;name="UserDatabase"&nbsp;auth="Container"<br>&nbsp;&nbsp;&nbsp;type="org.apache.catalina.UserDatabase"<br>&nbsp;&nbsp;&nbsp;description="User&nbsp;database&nbsp;that&nbsp;can&nbsp;be&nbsp;updated&nbsp;and&nbsp;saved"<br>&nbsp;&nbsp;&nbsp;factory="org.apache.catalina.users.MemoryUserDatabaseFactory"<br>&nbsp;&nbsp;&nbsp;pathname="conf/tomcat-users.xml"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Every&nbsp;connection&nbsp;to&nbsp;'db1'&nbsp;uses&nbsp;the&nbsp;same&nbsp;user&nbsp;--&gt;<br>&nbsp;&lt;Resource&nbsp;name="jdbc/db1"<br>&nbsp;&nbsp;&nbsp;auth="Container"<br>&nbsp;&nbsp;&nbsp;type="oracle.jdbc.pool.OracleDataSource"<br>&nbsp;&nbsp;&nbsp;driverClassName="oracle.jdbc.driver.OracleDriver"<br>&nbsp;&nbsp;&nbsp;factory="oracle.jdbc.pool.OracleDataSourceFactory"<br>&nbsp;&nbsp;&nbsp;url="jdbc:oracle:thin:@oracle.microdeveloper.com:1521:db1"<br>&nbsp;&nbsp;&nbsp;user="scott"<br>&nbsp;&nbsp;&nbsp;password="tiger"<br>&nbsp;&nbsp;&nbsp;maxActive="20"<br>&nbsp;&nbsp;&nbsp;maxIdle="10"<br>&nbsp;&nbsp;&nbsp;maxWait="-1"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Every&nbsp;connection&nbsp;to&nbsp;'db2'&nbsp;must&nbsp;provide&nbsp;a&nbsp;username&nbsp;and&nbsp;password&nbsp;--&gt;&nbsp;&nbsp;&lt;Resource&nbsp;name="jdbc/db2"<br>&nbsp;&nbsp;&nbsp;auth="Container"<br>&nbsp;&nbsp;&nbsp;type="oracle.jdbc.pool.OracleDataSource"<br>&nbsp;&nbsp;&nbsp;driverClassName="oracle.jdbc.driver.OracleDriver"<br>&nbsp;&nbsp;&nbsp;factory="oracle.jdbc.pool.OracleDataSourceFactory"<br>&nbsp;&nbsp;&nbsp;url="jdbc:oracle:thin:@oracle.microdeveloper.com:1521:db2"<br>&nbsp;&nbsp;&nbsp;maxActive="20"<br>&nbsp;&nbsp;&nbsp;maxIdle="10"<br>&nbsp;&nbsp;&nbsp;maxWait="-1"&nbsp;/&gt;<br>&lt;/GlobalNamingResources&gt;<br></blockquote><br>2) Modify the context.xml file<br>In &lt;CATALINA_HOME&gt;/conf/context.xml between &lt;Context&gt; and &lt;/Context&gt; add the following for each entry in the JNDI resource list:<br><blockquote class="src">&lt;ResourceLink&nbsp;global="jdbc/&lt;alias&gt;"&nbsp;name="jdbc/&lt;alias&gt;"&nbsp;type="oracle.jdbc.pool.OracleDataSource"/&gt;<br></blockquote><br>Example<br><blockquote class="src">&lt;!--&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;file&nbsp;will&nbsp;be&nbsp;loaded&nbsp;for&nbsp;each&nbsp;web&nbsp;application&nbsp;--&gt;<br>&nbsp;&lt;Context&gt;<br><br>&nbsp;&lt;!--&nbsp;Default&nbsp;set&nbsp;of&nbsp;monitored&nbsp;resources&nbsp;--&gt;<br>&nbsp;&lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;<br>&nbsp;&lt;WatchedResource&gt;META-INF/context.xml&lt;/WatchedResource&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Uncomment&nbsp;this&nbsp;to&nbsp;disable&nbsp;session&nbsp;persistence&nbsp;across&nbsp;Tomcat&nbsp;restarts&nbsp;--&gt;<br>&nbsp;&lt;!--<br>&nbsp;&lt;Manager&nbsp;pathname=""&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;--&gt;<br>&nbsp;&lt;ResourceLink&nbsp;global="jdbc/db1"&nbsp;name="jdbc/db1"&nbsp;type="oracle.jdbc.pool.OracleDataSource"/&gt;<br>&nbsp;&lt;ResourceLink&nbsp;global="jdbc/db2"&nbsp;name="jdbc/db2"&nbsp;type="oracle.jdbc.pool.OracleDataSource"/&gt;<br>&nbsp;&lt;/Context&gt;<br></blockquote><br>3) Modify the context's web.xml file (5.0.x step only - not necessary for 5.5.x)<br>In the &lt;CONTEXT&gt;/WEB-INF/web.xml between &lt;web-app&gt; and &lt;/web-app&gt; add the following:<br><blockquote class="src">&lt;resource-ref&gt;<br>&nbsp;&nbsp;&nbsp;&lt;description&gt;&lt;Your&nbsp;Description&gt;&lt;/description&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-ref-name&gt;jdbc/&lt;alias&gt;&lt;/res-ref-name&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-type&gt;oracle.jdbc.pool.OracleDataSource&lt;/res-type&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-auth&gt;Container&lt;/res-auth&gt;<br>&lt;/resource-ref&gt;<br></blockquote><br>Example<br><blockquote class="src">&lt;resource-ref&gt;<br>&nbsp;&nbsp;&nbsp;&lt;description&gt;Oracle&nbsp;Development&nbsp;Datasource&lt;/description&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-ref-name&gt;jdbc/db1&lt;/res-ref-name&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-type&gt;oracle.jdbc.pool.OracleDataSource&lt;/res-type&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-auth&gt;Container&lt;/res-auth&gt;<br>&lt;/resource-ref&gt;<br><br>&lt;resource-ref&gt;<br>&nbsp;&nbsp;&nbsp;&lt;description&gt;Oracle&nbsp;Development&nbsp;Datasource&lt;/description&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-ref-name&gt;jdbc/db2&lt;/res-ref-name&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-type&gt;oracle.jdbc.pool.OracleDataSource&lt;/res-type&gt;<br>&nbsp;&nbsp;&nbsp;&lt;res-auth&gt;Container&lt;/res-auth&gt;<br>&lt;/resource-ref&gt;<br></blockquote><br>4) Restart Tomcat<br><br></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
