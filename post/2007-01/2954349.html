<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[PHP] PHP에서 OpenID로 인증받도록 하기</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">권남</strong> 님 (<strong class="name">kwon37xi</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-01-23 19:48:32</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[PHP] PHP에서 OpenID로 인증받도록 하기</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">이번에 <a title="" href="http://www.openmaru.com">Openmaru Studio</a>에서 <a title="" href="http://www.myid.net">myid.net</a>을 오픈했다. <a title="" href="http://www.myid.net">myid.net</a>은 OpenID 인증 제공자이다.<br>OpenID는 한개의 ID로 여러 서로 다른 서비스에 로그인 하자! 라는 모토로 만들어진 공개 표준이다.<br><br>이에 관해서는 <a title="" href="http://www.openid.co.kr">OpenID 한국어 공식 홈페이지</a>와 <a title="" href="http://www.openid.co.kr">OpenID 한국 사용자 모임</a> 등을 참조해보면 된다.<br><br>이미 <a title="" href="http://wordpress.org/">WordPress</a> 와 <a title="" href="http://coolengineer.com/tt/371">TatterTools(비공식)</a> 등의 설치형 블로그 들이 OpenID를 플러그인으로 지원하고 있다.<br><br>자신이 만들고 있는 오픈 소스 웹 어플리케이션에서 Open ID로 사용자가 로그인 할 수 있도록 인증하고 싶은 분들이 틀림없이 있을 것이라 생각한다. 또한, 많은 분들이 자신의 웹 애플리케이션에 OpenID 인증을 허용했으면 하고 바란다.<br><br>이번에 내 자신이 OpenID 인증 기능을 붙여야 했기 때문에, 이에 관한 사항을 정리했다.<br><br>아래는 PHP용 OpenID 인증 라이브러리에 있는 라이브러리 사용 예의 주석을 한국어로 옮기고, 몇가지를 덧 붙인 것이다. 아래 예제를 깔고 자신의 OpenID로 인증을 직접 실행해 볼 수 있다.<br><br>실행 순서는 index.php -> try_auth.php -> OpenID 인증서버 -> finish_auth.php -> index.php 이다. 차례대로 따라가면서 보면 쉽게 이해가 될 것이다.<br><br><div class="h2">먼저 할 일</div><br>&nbsp;* <a title="" href="http://www.openidenabled.com/openid/libraries/php">PHP OpenID Library</a> 를 설치한다.<br><br>Windows의 경우, PHP/PEAR 설치 디렉토리에서 <strong>PEAR/Auth/OpenID/CyrptUtil.php</strong> 파일의<br>    define('Auth_OpenID_RAND_SOURCE', <strong>'/dev/urandom'</strong>);<br>위 부분을 찾아서 아래와 같이 바꾼다. <br>    define('Auth_OpenID_RAND_SOURCE', <strong>NULL</strong>);<br><br><div class="h2">common.php : 공통 부분</div><br><blockquote class="src">&lt;?php<br><br>$path_extra&nbsp;=&nbsp;dirname(dirname(dirname(__FILE__)));<br>$path&nbsp;=&nbsp;ini_get('include_path');<br>$path&nbsp;=&nbsp;$path_extra&nbsp;.&nbsp;':'&nbsp;.&nbsp;$path;<br>ini_set('include_path',&nbsp;$path);<br><br>/**<br>&nbsp;*&nbsp;Require&nbsp;the&nbsp;OpenID&nbsp;consumer&nbsp;code.<br>&nbsp;*/<br>/**<br>&nbsp;*&nbsp;OpenID&nbsp;컨슈머&nbsp;라이브러리&nbsp;사용을&nbsp;위해&nbsp;필요한&nbsp;라이브러리입니다.<br>&nbsp;*/<br>require_once&nbsp;"Auth/OpenID/Consumer.php";<br><br>/**<br>&nbsp;*&nbsp;Require&nbsp;the&nbsp;"file&nbsp;store"&nbsp;module,&nbsp;which&nbsp;we'll&nbsp;need&nbsp;to&nbsp;store&nbsp;OpenID<br>&nbsp;*&nbsp;information.<br>&nbsp;*/<br>/**<br>&nbsp;*&nbsp;OpenID&nbsp;관련&nbsp;정보를&nbsp;파일&nbsp;형태로&nbsp;저장하기위해&nbsp;필요한&nbsp;모듈입니다.<br>&nbsp;*/<br>require_once&nbsp;"Auth/OpenID/FileStore.php";<br><br>/**<br>&nbsp;*&nbsp;This&nbsp;is&nbsp;where&nbsp;the&nbsp;example&nbsp;will&nbsp;store&nbsp;its&nbsp;OpenID&nbsp;information.&nbsp;&nbsp;You<br>&nbsp;*&nbsp;should&nbsp;change&nbsp;this&nbsp;path&nbsp;if&nbsp;you&nbsp;want&nbsp;the&nbsp;example&nbsp;store&nbsp;to&nbsp;be&nbsp;created<br>&nbsp;*&nbsp;elsewhere.&nbsp;&nbsp;After&nbsp;you're&nbsp;done&nbsp;playing&nbsp;with&nbsp;the&nbsp;example&nbsp;script,<br>&nbsp;*&nbsp;you'll&nbsp;have&nbsp;to&nbsp;remove&nbsp;this&nbsp;directory&nbsp;manually.<br>&nbsp;*/<br>/**<br>&nbsp;*&nbsp;OpenID&nbsp;관련&nbsp;정보를&nbsp;저장하는&nbsp;디렉토리를&nbsp;지정합니다.<br>&nbsp;*&nbsp;적당한&nbsp;디렉토리로&nbsp;변경하십시오.<br>&nbsp;*/<br>$store_path&nbsp;=&nbsp;"E:/AutoSet/public_html/consumer/_php_consumer_test";<br><br><br>/**<br>&nbsp;*&nbsp;위&nbsp;디렉토리가&nbsp;존재하는지&nbsp;확인하고,&nbsp;존재하지&nbsp;않으면&nbsp;디렉토리를<br>&nbsp;*&nbsp;생성합니다.<br>&nbsp;*/<br>if&nbsp;(!file_exists($store_path)&nbsp;&amp;&amp;<br>&nbsp;&nbsp;&nbsp;&nbsp;!mkdir($store_path))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;"Could&nbsp;not&nbsp;create&nbsp;the&nbsp;FileStore&nbsp;directory&nbsp;'$store_path'.&nbsp;".<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Please&nbsp;check&nbsp;the&nbsp;effective&nbsp;permissions.";<br>&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br>}<br><br>/**<br>&nbsp;*&nbsp;정보&nbsp;저장소에&nbsp;관련한&nbsp;객체를&nbsp;생성합니다.<br>&nbsp;*/<br>$store&nbsp;=&nbsp;new&nbsp;Auth_OpenID_FileStore($store_path);<br><br>/**<br>&nbsp;*&nbsp;정보&nbsp;저장소&nbsp;객체를&nbsp;이용해서&nbsp;컨슈머&nbsp;객체를&nbsp;생성합니다.<br>&nbsp;*&nbsp;이&nbsp;객체를&nbsp;try_auth.php와&nbsp;finish_auth.php&nbsp;에서&nbsp;사용합니다.<br>&nbsp;*/<br>$consumer&nbsp;=&nbsp;new&nbsp;Auth_OpenID_Consumer($store);<br><br>?&gt;<br></blockquote><br><br><div class="h2">index.php : 사용자 OpenID 입력/결과 화면</div><br><blockquote class="src">&lt;?php<br>#&nbsp;한글이&nbsp;깨지면&nbsp;다음&nbsp;부분을&nbsp;euc-kr로&nbsp;변경하세요.<br>header("Content-type:&nbsp;text/html;&nbsp;charset=utf-8");<br>?&gt;<br>&lt;html&gt;<br>&nbsp;&nbsp;&lt;head&gt;&lt;title&gt;PHP&nbsp;OpenID&nbsp;Authentication&nbsp;Example&lt;/title&gt;&lt;/head&gt;<br>&nbsp;&nbsp;&lt;style&nbsp;type="text/css"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;verdana,sans-serif;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;50em;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin:&nbsp;1em;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding:&nbsp;.5em;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin:&nbsp;none;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding:&nbsp;none;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.alert&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#e7dc2b;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;#fff888;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.success&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#669966;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;#88ff88;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.error&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#ff0000;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;#ffaaaa;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#verify-form&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border:&nbsp;1px&nbsp;solid&nbsp;#777777;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background:&nbsp;#dddddd;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-top:&nbsp;1em;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding-bottom:&nbsp;0em;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&lt;/style&gt;<br>&nbsp;&nbsp;&lt;body&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;PHP&nbsp;OpenID&nbsp;Authentication&nbsp;Example&lt;/h1&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;이&nbsp;예제&nbsp;OpenID&nbsp;컨슈머는&nbsp;&lt;a<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href="http://www.openidenabled.com/openid/libraries/php/"&gt;PHP<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OpenID&lt;/a&gt;&nbsp;라이브러리를&nbsp;사용합니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;이것은&nbsp;단지&nbsp;당신의&nbsp;OpenID&nbsp;identity&nbsp;URL이&nbsp;정확한지&nbsp;확인합니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;?php&nbsp;if&nbsp;(isset($msg))&nbsp;{&nbsp;print&nbsp;"&lt;div&nbsp;class=\"alert\"&gt;$msg&lt;/div&gt;";&nbsp;}&nbsp;?&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;?php&nbsp;if&nbsp;(isset($error))&nbsp;{&nbsp;print&nbsp;"&lt;div&nbsp;class=\"error\"&gt;$error&lt;/div&gt;";&nbsp;}&nbsp;?&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;?php&nbsp;if&nbsp;(isset($success))&nbsp;{&nbsp;print&nbsp;"&lt;div&nbsp;class=\"success\"&gt;$success&lt;/div&gt;";&nbsp;}&nbsp;?&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id="verify-form"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;method="get"&nbsp;action="try_auth.php"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identity&amp;nbsp;URL:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="hidden"&nbsp;name="action"&nbsp;value="verify"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;name="openid_url"&nbsp;value=""&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="submit"&nbsp;value="Verify"&nbsp;/&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>&nbsp;&nbsp;&lt;/body&gt;<br>&lt;/html&gt;<br></blockquote><br><br><div class="h2">try_auth.php : 사용자가 입력한 OpenID를 인증 서버로 전송하여 인증 요청</div><br><blockquote class="src">&lt;?php<br><br>#&nbsp;초기화&nbsp;관련&nbsp;common.php를&nbsp;읽어들입니다.<br>require_once&nbsp;"common.php";<br><br>#&nbsp;세션을&nbsp;시작합니다.<br>session_start();<br><br>#&nbsp;사용자가&nbsp;자신의&nbsp;OpenID&nbsp;를&nbsp;입력했는지&nbsp;확인합니다.<br>if&nbsp;(empty($_GET['openid_url']))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;$error&nbsp;=&nbsp;"Expected&nbsp;an&nbsp;OpenID&nbsp;URL.";<br>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;'index.php';<br>&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br>}<br><br>#&nbsp;http/https&nbsp;여부를&nbsp;확인합니다.<br>$scheme&nbsp;=&nbsp;'http';<br>if&nbsp;(isset($_SERVER['HTTPS'])&nbsp;and&nbsp;$_SERVER['HTTPS']&nbsp;==&nbsp;'on')&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;$scheme&nbsp;.=&nbsp;'s';<br>}<br><br>$openid&nbsp;=&nbsp;$_GET['openid_url'];<br><br>#&nbsp;OpenID&nbsp;Provider(http://www.myid.net&nbsp;등)이&nbsp;로그인&nbsp;후<br>#&nbsp;관련&nbsp;정보를&nbsp;돌려줄&nbsp;URL을&nbsp;생성합니다.<br>#&nbsp;이&nbsp;역할은&nbsp;finish_auth.php&nbsp;가&nbsp;맡습니다.<br>$process_url&nbsp;=&nbsp;sprintf("$scheme://%s:%s%s/finish_auth.php",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SERVER['SERVER_NAME'],&nbsp;$_SERVER['SERVER_PORT'],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dirname($_SERVER['PHP_SELF']));<br><br>#&nbsp;Trust&nbsp;Root는&nbsp;OpenID로&nbsp;인증할&nbsp;서버의&nbsp;범위를&nbsp;지정합니다.<br>#&nbsp;현재&nbsp;예제&nbsp;프로그램이&nbsp;http://localhost/consumer&nbsp;에서&nbsp;실행된다면,<br>#&nbsp;http://localhost/consumer&nbsp;까지&nbsp;인증&nbsp;범위로&nbsp;지정합니다.<br>$trust_root&nbsp;=&nbsp;sprintf("$scheme://%s:%s%s",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SERVER['SERVER_NAME'],&nbsp;$_SERVER['SERVER_PORT'],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dirname($_SERVER['PHP_SELF']));<br><br>#&nbsp;OpenID&nbsp;인증&nbsp;작업을&nbsp;시작합니다.<br>$auth_request&nbsp;=&nbsp;$consumer-&gt;begin($openid);<br><br>#&nbsp;인증&nbsp;요청의&nbsp;객체가&nbsp;잘&nbsp;생성&nbsp;되었는지&nbsp;확인합니다.<br>if&nbsp;(!$auth_request)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;$error&nbsp;=&nbsp;"Authentication&nbsp;error.";<br>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;'index.php';<br>&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br>}<br><br>#&nbsp;인증&nbsp;서버로부터&nbsp;사용자의&nbsp;부가&nbsp;정보를&nbsp;받아오도록&nbsp;설정한다.<br>#&nbsp;여기에서&nbsp;별명이나&nbsp;이메일&nbsp;주소&nbsp;등을&nbsp;받을&nbsp;수&nbsp;있다.<br>#&nbsp;자세한&nbsp;정보&nbsp;:&nbsp;http://www.openidenabled.com/openid/simple-registration-extension<br>#<br>#&nbsp;첫&nbsp;번째&nbsp;인자&nbsp;:&nbsp;"sreg"<br>#&nbsp;두&nbsp;번째&nbsp;인자&nbsp;:&nbsp;"optional"&nbsp;-&nbsp;선택&nbsp;입력&nbsp;항목,&nbsp;혹은&nbsp;"required"&nbsp;-&nbsp;필수&nbsp;입력&nbsp;항목<br>#&nbsp;세번째&nbsp;인자&nbsp;:&nbsp;원하는&nbsp;키를&nbsp;email,nickname&nbsp;과&nbsp;같은&nbsp;식으로&nbsp;나열한다.<br>$auth_request-&gt;addExtensionArg('sreg',&nbsp;'required',&nbsp;'nickname,email');<br>$auth_request-&gt;addExtensionArg('sreg',&nbsp;'optional',&nbsp;'postcode');<br><br>//&nbsp;Redirect&nbsp;the&nbsp;user&nbsp;to&nbsp;the&nbsp;OpenID&nbsp;server&nbsp;for&nbsp;authentication.&nbsp;&nbsp;Store<br>//&nbsp;the&nbsp;token&nbsp;for&nbsp;this&nbsp;authentication&nbsp;so&nbsp;we&nbsp;can&nbsp;verify&nbsp;the&nbsp;response.<br><br>#&nbsp;OpenID&nbsp;서버로&nbsp;사용자를&nbsp;Redirect&nbsp;시킨다.<br>#&nbsp;이&nbsp;때&nbsp;토큰을&nbsp;저장하여,&nbsp;Consumer가&nbsp;요청한&nbsp;서버로부터<br>#&nbsp;(나중에)&nbsp;응답이&nbsp;제대로&nbsp;왔는지&nbsp;확인한다.<br>$redirect_url&nbsp;=&nbsp;$auth_request-&gt;redirectURL($trust_root,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$process_url);<br><br>#&nbsp;실제&nbsp;Redirection이&nbsp;일어난다.<br>#&nbsp;여기서&nbsp;var_dump($redirect_url);&nbsp;를&nbsp;실행해&nbsp;보면&nbsp;OpenID&nbsp;인증&nbsp;서버로&nbsp;이동하는&nbsp;주소를<br>#&nbsp;확인할&nbsp;수&nbsp;있다.<br>header("Location:&nbsp;".$redirect_url);<br>?&gt;<br></blockquote><br><br><div class="h2">finish_auth.php : OpenID 인증 완료 -> index.php로 간다</div><br><blockquote class="src">&lt;?php<br><br>#&nbsp;초기화&nbsp;관련&nbsp;common.php를&nbsp;읽어들입니다.<br>require_once&nbsp;"common.php";<br><br>session_start();<br><br>//&nbsp;OpenID&nbsp;서버의&nbsp;응답을&nbsp;받아서&nbsp;인증&nbsp;과정을&nbsp;마무리합니다.<br>$response&nbsp;=&nbsp;$consumer-&gt;complete($_GET);<br><br>if&nbsp;($response-&gt;status&nbsp;==&nbsp;Auth_OpenID_CANCEL)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;인증이&nbsp;취소&nbsp;되었습니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;'인증이&nbsp;취소되었습니다.';<br>}&nbsp;else&nbsp;if&nbsp;($response-&gt;status&nbsp;==&nbsp;Auth_OpenID_FAILURE)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;인증이&nbsp;실패하였습니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;$msg&nbsp;=&nbsp;"인증이&nbsp;실패하였습니다&nbsp;:&nbsp;"&nbsp;.&nbsp;$response-&gt;message;<br>}&nbsp;else&nbsp;if&nbsp;($response-&gt;status&nbsp;==&nbsp;Auth_OpenID_SUCCESS)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;인증이&nbsp;성공한&nbsp;이후의&nbsp;과정을&nbsp;수행합니다.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;사용자의&nbsp;OpenID를&nbsp;가져옵니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;$openid&nbsp;=&nbsp;$response-&gt;identity_url;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;특수&nbsp;문자를&nbsp;제거하여&nbsp;화면상에&nbsp;출력&nbsp;시킵니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;$esc_identity&nbsp;=&nbsp;htmlspecialchars($openid,&nbsp;ENT_QUOTES);<br>&nbsp;&nbsp;&nbsp;&nbsp;$success&nbsp;=&nbsp;sprintf('성공적으로&nbsp;로그인&nbsp;하였습니다.&nbsp;'&nbsp;.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&lt;a&nbsp;href="%s"&gt;%s&lt;/a&gt;&nbsp;로&nbsp;로그인되었습니다.&lt;br&nbsp;/&gt;',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$esc_identity,&nbsp;$esc_identity);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;뭘까요?&nbsp;알아맞춰보세요~&nbsp;ㅜㅜ<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($response-&gt;endpoint-&gt;canonicalID)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$success&nbsp;.=&nbsp;'&nbsp;&nbsp;(XRI&nbsp;CanonicalID:&nbsp;'.$response-&gt;endpoint-&gt;canonicalID.')&nbsp;&lt;br&nbsp;/&gt;';<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;사용자에&nbsp;대한&nbsp;부가&nbsp;정보&nbsp;요청한&nbsp;것을&nbsp;확인합니다.<br>&nbsp;&nbsp;&nbsp;&nbsp;$sreg&nbsp;=&nbsp;$response-&gt;extensionResponse('sreg');<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(@$sreg['email'])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$success&nbsp;.=&nbsp;"&nbsp;&nbsp;당신의&nbsp;이메일&nbsp;주소는&nbsp;'".$sreg['email']."'&nbsp;입니다.&lt;br&nbsp;/&gt;";<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(@$sreg['nickname'])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$success&nbsp;.=&nbsp;"&nbsp;&nbsp;당신의&nbsp;별명은&nbsp;'".$sreg['nickname']."'&nbsp;입니다.&lt;br&nbsp;/&gt;";<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(@$sreg['postcode'])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$success&nbsp;.=&nbsp;"&nbsp;&nbsp;당신의&nbsp;우편번호는&nbsp;'".$sreg['postcode']."'&nbsp;입니다.&lt;br&nbsp;/&gt;";<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>include&nbsp;'index.php';<br><br>?&gt;<br></blockquote><br><br><div class="h2">인증 완료 후 화면</div><br><img src='./2954349/b0046915_07011110.png'></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
