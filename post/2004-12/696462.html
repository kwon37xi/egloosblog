<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>SAAJ 예제</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">권남</strong> 님 (<strong class="name">kwon37xi</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2004-12-21 20:04:20</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">SAAJ 예제</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">이것은 SAAJ API를 이용해서 SOAP 메시지를 생성하고 전송하는 예제이다.<br><br>인벨롭과 헤더, 바디, 첨부, 폴트를 생성하고 내용을 출력한 뒤에 전송하는 과정이 모두 망라되어 있다.<br><br><a href="http://www.kyobobook.co.kr/category/bookdetail/BookDetailView.jsp?CLICK=FRE&NEWCLICK=HA1&BKIND=KOR&CATE=&BARCODE=9788989345664&FLAG=0&PRE_QUERY=%28XML%3Cand%3E%28%C0%A5%3COR%3EWEB%29%3Cand%3E%BC%AD%BA%F1%BD%BA%29%3Cin%3Etotal&QUERY_TEXT=&PRE_QUERY_TEXT=XML+%C0%A5+%BC%AD%BA%F1%BD%BA&REQUERY_CHECK=&CLASS_CODE_CHECK=&PAGENUM=START&PAGE_CLICK=&INITIAL=&INITIAL_CLICK=&INITIAL_QUERY=&TOTAL_CHECK=&BEST_CHECK=&TOP_CHECK=&TOP_FIELD=total&ADD_FIELD=total&QUERY=&EJK=KOR&CLASS_CODE=ROOT&SORT_FIELD=favor_score&MAX_DOC=1000&DOC_PAGE=10&FIELD=book_nm&REQUERY=&INPUT_GB=1&INPUT_GB=1&INPUT_GB=1&INPUT_GB=1">XML 웹 서비스</a>라는 책에 나온 예제를 조합하여 버그를 잡은 것이다.<br>이 책 내용은 상당히 알기 쉽다. 초보자가 웹 서비스를 이해하는데 도움이 될듯하고, 자바를 중심으로 씌여져 있다. 헌데, 오타가 좀 많고, 예제가 JWSDP 1.1기준이다. 현재 1.5가 나온 상황에서 안되는게 꽤 있는데, 그리 차이는 많이 나지 않는다.<br>지금 올리는 예제는 1.5에서 되는 것이다.<br><br><blockquote class="src" style="height: 300px;">import&nbsp;javax.xml.soap.*;<br>import&nbsp;java.net.*;<br>import&nbsp;javax.activation.DataHandler;<br><br>public&nbsp;class&nbsp;SAAJTest&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String&nbsp;[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPMessage&nbsp;객체&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageFactory&nbsp;messageFactory&nbsp;=&nbsp;MessageFactory.newInstance();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPMessage&nbsp;requestMessage&nbsp;=&nbsp;messageFactory.createMessage();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPPart&nbsp;객체&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPPart&nbsp;soapPart&nbsp;=&nbsp;requestMessage.getSOAPPart();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPEnvelope&nbsp;객체&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPEnvelope&nbsp;envelope&nbsp;=&nbsp;soapPart.getEnvelope();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;네임스페이스&nbsp;지정<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envelope.addNamespaceDeclaration("xsd",&nbsp;"http://www.w3.org/2001/XMLSchema");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envelope.addNamespaceDeclaration("xsi",&nbsp;"http://www.w3.org/2001/XMLSchema-instance");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envelope.addNamespaceDeclaration("enc",&nbsp;"http://www.w3.org/schemas.xmlsoap.org/soap/encoding/");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envelope.addNamespaceDeclaration("ns0",&nbsp;"http://localhost:8080/hello/webservice/wsdl/webservice");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;인코딩&nbsp;방식&nbsp;지정<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;envelope.setEncodingStyle("http://schemas.xmlsoap.org/soap/encoding/");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPFactory&nbsp;객체&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPFactory&nbsp;soapFactory&nbsp;=&nbsp;SOAPFactory.newInstance();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPHeader&nbsp;객체&nbsp;얻기<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPHeader&nbsp;header&nbsp;=&nbsp;envelope.getHeader();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;헤더&nbsp;엔트리&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;name&nbsp;=&nbsp;soapFactory.createName(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"authentication",&nbsp;"auth",&nbsp;"http://www.mincheol.com/auth");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPHeaderElement&nbsp;headerElement&nbsp;=&nbsp;header.addHeaderElement(name);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headerElement.setActor("http://www.mincheol.com/auth");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headerElement.setMustUnderstand(true);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;헤더&nbsp;엔트리&nbsp;자식&nbsp;엘리먼트&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;soapFactory.createName("userid");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPElement&nbsp;useridElement&nbsp;=&nbsp;headerElement.addChildElement(name);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;useridElement.addTextNode("angel");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;헤더&nbsp;엔트리&nbsp;자식&nbsp;엘리먼트&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;soapFactory.createName("password");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPElement&nbsp;passwordElement&nbsp;=&nbsp;headerElement.addChildElement(name);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passwordElement.addTextNode("abc12345");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPBody&nbsp;객체&nbsp;얻기<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPBody&nbsp;body&nbsp;=&nbsp;envelope.getBody();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;바디&nbsp;엔트리&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;이미&nbsp;envelope에서&nbsp;네임스페이스를&nbsp;선언했으므로&nbsp;마지막인자는&nbsp;null&nbsp;이다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;bodyName&nbsp;=&nbsp;soapFactory.createName("sayHello",&nbsp;"ns0",&nbsp;null);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPBodyElement&nbsp;bodyElement&nbsp;=&nbsp;body.addBodyElement(bodyName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;바디&nbsp;엔트리&nbsp;자식&nbsp;엘리먼트&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;childName&nbsp;=&nbsp;soapFactory.createName("String_1");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPElement&nbsp;childElement&nbsp;=&nbsp;bodyElement.addChildElement(childName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;typeName&nbsp;=&nbsp;soapFactory.createName("type",&nbsp;"xsi",&nbsp;null);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;childElement.addAttribute(typeName,&nbsp;"xsd:string");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;childElement.addTextNode("mincheol");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;첨부물&nbsp;위치<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URL&nbsp;url&nbsp;=&nbsp;new&nbsp;URL("file:///home/kwon37xi/.vimrc");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;contentId&nbsp;=&nbsp;"attached_image";<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;AttachmentPart&nbsp;객체&nbsp;얻기<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataHandler&nbsp;dataHandler&nbsp;=&nbsp;new&nbsp;DataHandler(url);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AttachmentPart&nbsp;attachment&nbsp;=&nbsp;requestMessage.createAttachmentPart(dataHandler);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachment.setContentId(contentId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;요청&nbsp;SOAP&nbsp;메시지에&nbsp;추가<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestMessage.addAttachmentPart(attachment);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPFault&nbsp;객체&nbsp;얻기<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPFault&nbsp;fault&nbsp;=&nbsp;body.addFault();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fault.setFaultCode(envelope.getPrefix()&nbsp;+&nbsp;":Client");&nbsp;//&nbsp;faultcode에는&nbsp;접두사가필요하다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fault.setFaultActor("http://www.mincheol.com/auth");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fault.setFaultString("Message&nbsp;does&nbsp;not&nbsp;have&nbsp;necessary&nbsp;info");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Detail&nbsp;detail&nbsp;=&nbsp;fault.addDetail();&nbsp;//&nbsp;detail&nbsp;정보&nbsp;생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;entryName&nbsp;=&nbsp;soapFactory.createName("content");&nbsp;//&nbsp;네임스페이스&nbsp;불필요<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DetailEntry&nbsp;entry&nbsp;=&nbsp;detail.addDetailEntry(entryName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entry.addTextNode("userid&nbsp;element&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;value");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;지금까지&nbsp;생성된&nbsp;XML&nbsp;SOAP&nbsp;메시지를&nbsp;화면에&nbsp;출력한다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("-----------------------------------------------------");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestMessage.writeTo(System.out);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("-----------------------------------------------------");<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SOAPConnection&nbsp;객체생성<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPConnectionFactory&nbsp;soapConnectionFactory&nbsp;=&nbsp;SOAPConnectionFactory.newInstance();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPConnection&nbsp;connection&nbsp;=&nbsp;soapConnectionFactory.createConnection();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;요청&nbsp;SOAP&nbsp;메시지를&nbsp;보내고,&nbsp;응답&nbsp;SOAP&nbsp;메시지를&nbsp;받는다.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOAPMessage&nbsp;responseMessage&nbsp;=&nbsp;connection.call(requestMessage,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://localhost:9000/hello/webservice");<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></blockquote></div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
