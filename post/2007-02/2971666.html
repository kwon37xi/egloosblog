<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../css/result.css">

        <title>[PHP] 로깅(Logging) 전략</title>
    </head>
    <body>
        <section id="wrap">
            <header>
                <h1 class="logo-title">
                    <span class="main"><img src="../../images/logo_egloos.png" width="105" height="34" alt="이글루스"></span>
                </h1>
                <div class="user-info">
                    <strong class="name">권남</strong> 님 (<strong class="name">kwon37xi</strong>)
                </div>
            </header>
            <main>
                <article class="post-wrap">
                    <!-- 게시물 정보 : 날짜 -->
                    <div class="post-info">
                        <span class="time">2007-02-01 10:25:50</span>
                    </div>
                    <!-- 게시물 제목 -->
                    <h2 class="post-title">[PHP] 로깅(Logging) 전략</h2>
                    <!-- 게시물 본문 -->
                    <div class="post-body">
                        <div class="content">개발시 디버깅을 위해 필수적으로 필요한 것이 로그이다. 이는 개발시 뿐만 아니라 운영중에 오류가 발생했을 때도 오류의 원인을 찾는데 커다란 역할을 하는 중요한 개발 요소 중의 하나이다.<br><br>PHP에서 개발자의 로그를 어떻게 남기는지 몰라서 계속해서 <code>var_dump($variable);</code>로 브라우저 화면에 로그를 남겨서 본 뒤에 그 로그 출력 코드를 삭제해 버리는 방식으로 작업을 했다.<br>대다수의 PHP 개발자들이 var_dump(), print_r() 함수등을 이용해서 위와 같은 방식으로 로그를 기록해서 디버깅을 하는 것 같다. 하지만 이는 매우 좋지 못한 방식이다.<br><blockquote class="quote">&nbsp;* 로그를 출력 한 뒤에 로그 출력 코드를 항상 지워야만 한다. 그렇지 않으면 로그가 브라우저를 통해 사용자에게 전달 돼 버리므로.<br>&nbsp;* 이로인해 매우 개발이 귀찮기 짝이 없는 작업이 된다.<br>&nbsp;* 실제 운영 시간에 발생한 오류에 대해 에러 메시지만을 얻을 수 있을 뿐 그 당시 상태에 관한 로그를 전혀 얻을 수가 없다.</blockquote><br>그러다가, 너무 짜증이나서 <a title="" href="http://www.phpschool.com/gnuboard4/bbs/board.php?bo_table=qna_other&wr_id=88190">간단한 로깅 함수</a>를 만들어서 바꾸었다.<br>그러나 여전히 맘에 안든다. 로그 레벨 지정이나, 로그 파일 날짜별로 돌리기 등 기능이 너무 부족하다.<br><br>PHP에서 로깅 전략에 대한 글을 찾아보니 우리나라에서는 거의 없는거 같고, <a title="" href="http://www.devshed.com/c/a/PHP/Logging-With-PHP/">devshed에 Logging With PHP라는 좋은 글</a>이 있었다.<br>그 중에서도 <a title="" href="http://pear.php.net/package-info.php?package=Log">PEAR Log Package</a>를 이용하기로 하였다. PEAR에는 여러 좋은 패키지들이 많이 깔끔하게 정리되어 있는 것 같다. 근데, 우리나라 PHP 개발자들은 아직 잘 안쓰는건가? 관련 글을 찾아보기가 쉽지 않네.<br><br>그 외에도 <a title="" href="http://logging.apache.org/log4php/">Log4PHP</a>가 있는데, 사실 이걸 쓰고 싶은 생각이 정말 많이 들었었다. <a title="" href="http://www.apache.org">Apache</a>에서 만든 것이고, 이미 내게 익숙한 <a title="" href="http://logging.apache.org/log4j">Log4J</a>의 PHP 포팅이기 때문이다. 게다가 설정 파일을 통해 언제든지 로깅 방식을 변경할 수도 있다(Log4J처럼). 하지만, 참은 이유는.... 2003년 이후 버전업이 전혀 안되고 있기 때문이다. 4년씩이나 버전 업이 안되는 건 좀 이해가 안간다.<br><br>PEAR::Log 사용법과 로그 레벨 지정, 날짜별 파일로 로그 남기기, 로그를 남길 때마다 어떤 PHP파일의 몇 번째 줄에서 로그를 남겼는지 출력하기, PHP의 오류 메시지를 PEAR::Log를 이용해 로그로 남기기 등의 기법을 정리해 본다. 대부분의 내용은 PEAR::Log의 매뉴얼을 정리한 것이다.<div class="h2">설치</div><br><blockquote class="src">$ pear install log</blockquote><br><br><div class="h2">로깅 객체 얻기</div><br><blockquote class="src">require_once&nbsp;'Log.php';<br><br>$logger&nbsp;=&nbsp;&amp;Log::singletone('file',&nbsp;'C:/temp/test.log',&nbsp;'Test');&nbsp;#&nbsp;로깅을&nbsp;위한&nbsp;객체&nbsp;얻기<br>$logger-&gt;log('이래&nbsp;저래&nbsp;에러가&nbsp;났잖아욧!');&nbsp;#&nbsp;로그&nbsp;메시지&nbsp;출력하기<br></blockquote><br>싱글턴으로 객체를 가져옴으로써 불필요한 객체 생성과, 객체가 소유하고 있는 리소스의 중복 정의를 방지한다.<br><br><div class="h3">&Log::singleton($handler, $name, $ident, $conf, $maxLevel);</div><br>&nbsp;* $handler : 로그 핸들러 타입. console, file 등 로그 출력을 처리하는 방식을 지정한다.$name :  파일 이름과 같이, 로그를 기록할 자원을 지정한다. 핸들러 구현체에 따라서 이 파라미터가 뭘로 사용될지 결정된다.<br>&nbsp;* $name : 로그 파일명 등을 의미한다. $handler에 따라 의미가 달라진다.<br>&nbsp;* $ident : 로그 구분자이다. Java의 Log4j에서 클래스 FQCN과 같은 역할을 한다.<br>&nbsp;* $conf : 연관 배열로 핸들러에 사용자 정의 설정 정보를 넘겨준다.<br>&nbsp;* $maxLevel : 최대 로그 레벨을  결정한다. 기본값은 PEAR_LOG_DEBUG(최대값)이다. 이 레벨보다 낮아야 로그가 기록된다.<br><br><strong><code>$logger-&gt;log("로그메시지", PEAR_LOG_NOTICE);</code></strong>와 같은 방식으로 로그를 기록한다.<br><br>로그 메시지 부분에는 문자열 뿐만 아니라, 일반 객체를 지정해도 된다. 객체가 getString(), toString() 혹은 __toString() 메소드를 구현하고 있다면 그 메소드를 실행해서 메시지를 기록한다. 모두 없다면 객체를  직렬화한 값을 출력할 것이다.<br><br>만약 배열과 같이 복잡한 타입의 변수 값을 제대로 찍고 싶다면 $logger-&gt;log($variable) 처럼, 문자열로 바꾸지 말고, 변수를 그대로 인자로 넘겨주면, var_dump($variable) 한 것처럼 변수 내용을 찍어준다.<br><br><div class="h2">로그 레벨</div><br>로그 레벨 옆의 메소드명은 log() 메소드에 로그 레벨을 지정하는 대신, 해당 메소드를 직접 호출하면, 그 로그 레벨로 로그가 남게 됨을 의미한다.<br>즉, <strong>$logger-&gt;log("로그메시지", PEAR_LOG_DEBUG)</strong> 는 <strong>$logger-&gt;debug(" 로그메시지")</strong> 와 동일한 역할을 한다.<br>&nbsp;* PEAR_LOG_EMERG  emerg() 시스템이 사용 불가 상태에 빠졌다.<br>&nbsp;* PEAR_LOG_ALERT alert() 즉시 처리가 필요하다.<br>&nbsp;* PEAR_LOG_CRIT crit() 심각한 상태이다.<br>&nbsp;* PEAR_LOG_ERR err() 오류<br>&nbsp;* PEAR_LOG_WARNING warning() 경고<br>&nbsp;* PEAR_LOG_NOTICE notice() 주의<br>&nbsp;* PEAR_LOG_INFO info() 정보<br>&nbsp;* PEAR_LOG_DEBUG debug() 디버그 메시지<br><br><div class="h2">로그 레벨 마스크(mask)</div><br>특정 로그 레벨의 로그 메시지만 출력하도록 지정한다.<br><blockquote class="src">$mask&nbsp;=&nbsp;Log::UPTO(PEAR_LOG_INFO);<br>$logger-&gt;setMask($mask);</blockquote><br>최소 PEAR_LOG_INFO 까지 로그 메시지만 출력한다. 즉, PEAR_LOG_EMER ~ PEAR_LOG_INFO 까지 메시지만 로그로 남긴다.<br><blockquote class="src">$mask&nbsp;=&nbsp;Log::MASK(PEAR_LOG_NOTICE)&nbsp;|&nbsp;Log::MASK(PEAR_LOG_DEBUG);</blockquote><br>PEAR_LOG_NOTICE와 PEAR_LOG_DEBUG 레벨의 메시지만을 로그로 남긴다.<br>&nbsp;* PEAR_LOG_ALL 모든 로그 레벨을 포함하고 있는 마스크<br>&nbsp;* PEAR_LOG_NONE 어떤 로그 레벨도 포함하지 않고 있는 마스크<br><br><blockquote class="src">$mask&nbsp;=PEAR_LOG_ALL&nbsp;^&nbsp;Log::MASK(PEAR_LOG_NOTICE);</blockquote><br>PEAR_LOG_NOTICE만 제외하고 로그를 남긴다.<br><blockquote class="src">$logger-&gt;getMask(); </blockquote><br>현재 로거의 로그 마스크를 가져온다.<br><br><div class="h2">로그 이벤트 내보내기</div><br>몇몇 로그 핸들러는 로그 메시지를 버퍼링 한다. 버퍼링된 로그 메시지를 모두 출력하도록 하려면,<br><blockquote class="src">$logger-&gt;flush();<br>혹은,<br>$logger-&gt;close();<br></blockquote><br>로거를 닫아도 flush가 된다.<br><br><div class="h2">로그 핸들러</div><br>로그 핸들러는 로그를 어떤식으로 처리할지를 결정하는 것이다. 모든 로거는 로그 핸들러를 지정해야 한다.<br>로그 객체를가져올 때 'console' 하는 식으로 지정하는 것이다. 구체적인 사용법은 매뉴얼을 참조한다.<br>&nbsp;* console  : 화면상에 로그를 출력한다.<br>&nbsp;* display : 웹 브라우저에 로그를 출력한다.<br>&nbsp;* error_log : PHP의 error_log 함수를 사용해서 로그를 출력한다.<br>&nbsp;* file : 파일로 로그를 출력한다.<br>&nbsp;* mail : 이메일로 로그를 전송한다.<br>&nbsp;* null : 로그를 무시한다.<br>&nbsp;* sql : DB에 로그를 저장한다.<br>&nbsp;* sqlite : SQLite DB에 로그를 저장한다.<br>&nbsp;* syslog : PHP의 syslog() 함수를 이용해서 로그를 저장한다.<br>&nbsp;* win : 브라우저의 새창으로 로그를 출력한다.<br>&nbsp;* composite : 여러 핸들러를 함께 사용할 수 있게 해준다.<br><blockquote class="src">$console&nbsp;=&nbsp;&amp;Log::singleton('console',&nbsp;'',&nbsp;'TEST');<br>$file&nbsp;=&nbsp;&amp;Log::singletone('file',&nbsp;'out.log',&nbsp;'TEST');<br>$composite&nbsp;=&nbsp;&amp;Log::singleton('composite');<br>$composite-&gt;addChild(&amp;console);<br>$composite-&gt;addChild($file);<br>$composite-&gt;log('blah&nbsp;blah&nbsp;blah...');<br>$composite-&gt;removeChild($file);&nbsp;#&nbsp;로그&nbsp;핸들러&nbsp;삭제<br></blockquote><br><br><div class="h2">File 로그 핸들러</div><br>file 로그 핸들러를 제일 많이 사용할 것이기 때문에, 이에대해 정리한다.<br>&nbsp;* 설정값 : 설정키(Type, 기본값)<br>&nbsp;&nbsp;o append(boolean, true) : true이면 기존의 로그파일에 계속 추가해서  쓰고, false이면 기존 파일을 삭제하고 새로 쓴다.<br>&nbsp;&nbsp;o mode(integer, 0644) : Unix 계열에서 파일의 허가권 지정<br>&nbsp;&nbsp;o eol(string, OS default) : 줄끝 문자<br>&nbsp;&nbsp;o lineFormat(string ,%1$s %2$s [%3$s] %4$s]) 로그 출력 형태 지정<br>&nbsp;&nbsp;o timeFormat(string, %b %d %H:%M:%S) : 시간 출력 형태 지정(strftime 함수로 시간을 출력한다.)<br>&nbsp;* 설정값의 lineFormat<br>&nbsp;&nbsp;o %1$s : 날짜와 시간<br>&nbsp;&nbsp;o %2$s : $ident<br>&nbsp;&nbsp;o %3$s : 로그 레벨<br>&nbsp;&nbsp;o %4$s : 로그 메시지<br>&nbsp;&nbsp;o %5$s : log() 메소드를 호출한 파일명<br>&nbsp;&nbsp;o %6$s : log()메소드를 호출한 줄 번호<br>&nbsp;&nbsp;o %7$s : log()메소드를 호출한 함수명<br>&nbsp;* 예제<br><blockquote class="src">$conf&nbsp;=&nbsp;array('mode'=&gt;0600,&nbsp;'timeFormat'=&gt;'%X&nbsp;%x');<br>$logger&nbsp;=&nbsp;&amp;Log::singletone('file',&nbsp;'out.log',&nbsp;'ident',&nbsp;$conf);<br>for&nbsp;($i&nbsp;=&nbsp;0;&nbsp;$i&nbsp;&lt;&nbsp;10;&nbsp;$i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;$logger-&gt;log("Log&nbsp;entry&nbsp;$1");<br>}<br></blockquote><br><br><div class="h2">표준 오류 출력을 PEAR::Log 패키지로 위임하기</div><br>PHP 사용중 발생하는 예외와 오류를 PEAR::Log 패키지를 이용해 처리하도록 지정할 수 있다.<br>이것은 <strong>set_error_handler()</strong> 함수를 이용해서 가능하다.<br><blockquote class="src">function&nbsp;errorHandler($code,&nbsp;$message,&nbsp;$file,&nbsp;$line)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;$logger;<br>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Map&nbsp;the&nbsp;PHP&nbsp;error&nbsp;to&nbsp;a&nbsp;Log&nbsp;priority.&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;($code)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_WARNING:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_WARNING:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_WARNING;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_NOTICE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_NOTICE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority=PEAR_LOG_NOTICE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_ERROR:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_ERROR:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_ERR;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_INFO;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;$logger-&gt;log($message&nbsp;.&nbsp;'&nbsp;in&nbsp;'&nbsp;.&nbsp;$file&nbsp;.&nbsp;'&nbsp;at&nbsp;line&nbsp;'&nbsp;.&nbsp;$line,&nbsp;$priority);<br>}&nbsp;//&nbsp;end&nbsp;of&nbsp;function<br><br>set_error_handler('errorHandler');<br><br>#&nbsp;test<br>trigger_error('This&nbsp;is&nbsp;an&nbsp;information&nbsp;log&nbsp;message.',&nbsp;E_USER_NOTICE);<br></blockquote><br><br><div class="h2">나는 이렇게 사용한다</div><br>강력한 설정기능 등이 Log4php에 비해 많이 딸리는 편인데, 어쨌든, 나는 아래 처럼 사용한다.<br>아래에서 정의한 logger() 함수는 PEAR::Log를 이용해서, 날짜별로 로그 파일을 남기는 것이다.<br>그리고, 로그를 남길 때는 항상 로그를 찍은 소스 파일명과 로그를 찍은 코드의 줄 번호도 함께 출력하도록 하였다.<br>파일 이름은 logger.php라고 치자.<br><blockquote class="src" style="height: 300px">&lt;?php<br>require_once&nbsp;'Log.php';<br><br>//&nbsp;PHP&nbsp;5.1.x&nbsp;의&nbsp;set_error_handler()로&nbsp;지정된&nbsp;함수&nbsp;내부에서<br>//&nbsp;클래스&nbsp;정의를&nbsp;가진&nbsp;PHP&nbsp;파일을&nbsp;require/include&nbsp;할&nbsp;경우에<br>//&nbsp;오류가&nbsp;발생하는&nbsp;문제를&nbsp;해결하기&nbsp;위해<br>//&nbsp;미리&nbsp;필요한&nbsp;클래스를&nbsp;require&nbsp;해둬야&nbsp;한다.<br>//&nbsp;관련&nbsp;URL&nbsp;:&nbsp;http://bugs.php.net/35634<br>require_once&nbsp;'Log/file.php';<br><br>/**<br>&nbsp;*&nbsp;사용자가&nbsp;명시적으로&nbsp;LOG_FILENAME&nbsp;상수를&nbsp;지정하지&nbsp;않았다면,<br>&nbsp;*&nbsp;오류를&nbsp;발생시킨다.<br>&nbsp;*/<br>if&nbsp;(!defined('LOG_FILENAME'))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;trigger_error("You&nbsp;have&nbsp;to&nbsp;define&nbsp;LOG_FILENAME&nbsp;for&nbsp;logger",&nbsp;E_USER_ERROR);<br>}<br><br>/**<br>&nbsp;*&nbsp;사용자가&nbsp;명시적으로&nbsp;LOG_LEVEL&nbsp;상수를&nbsp;정의하지&nbsp;않았다면,<br>&nbsp;*&nbsp;DEBUG&nbsp;로그&nbsp;레벨로&nbsp;강제&nbsp;지정한다.<br>&nbsp;*&nbsp;<br>&nbsp;*&nbsp;이&nbsp;파일&nbsp;외부에서&nbsp;로그&nbsp;레벨을&nbsp;지정할&nbsp;경우,&nbsp;require_once&nbsp;'Log.php';&nbsp;를&nbsp;실행한<br>&nbsp;*&nbsp;이후에&nbsp;상수에&nbsp;PEAR_LOG_*&nbsp;값을&nbsp;줘야&nbsp;함을&nbsp;잊어서는&nbsp;안된다.<br>&nbsp;*/<br>if&nbsp;(!defined('LOG_LEVEL'))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;define&nbsp;('LOG_LEVEL',&nbsp;PEAR_LOG_DEBUG);<br>}<br><br>/**<br>&nbsp;*&nbsp;PHP자체에서&nbsp;발생하는&nbsp;로그의&nbsp;레벨을&nbsp;지정한다.<br>&nbsp;*&nbsp;errorHandler()&nbsp;함수에서&nbsp;이&nbsp;로그레벨을&nbsp;넘지&nbsp;않으면,&nbsp;오류를&nbsp;출력하지&nbsp;않도록<br>&nbsp;*&nbsp;만들어져&nbsp;있다.<br>&nbsp;*&nbsp;<br>&nbsp;*&nbsp;이&nbsp;파일&nbsp;외부에서&nbsp;로그&nbsp;레벨을&nbsp;지정할&nbsp;경우,&nbsp;require_once&nbsp;'Log.php';&nbsp;를&nbsp;실행한<br>&nbsp;*&nbsp;이후에&nbsp;상수에&nbsp;PEAR_LOG_*&nbsp;값을&nbsp;줘야&nbsp;함을&nbsp;잊어서는&nbsp;안된다.<br>&nbsp;*/<br>if&nbsp;(!defined('PHP_LOG_LEVEL'))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;define('PHP_LOG_LEVEL',&nbsp;PEAR_LOG_WARNING);<br>}<br><br>//&nbsp;PHP&nbsp;에러&nbsp;핸들러를&nbsp;PEAR::Log&nbsp;를&nbsp;사용하도록&nbsp;변경한다.<br>set_error_handler('errorHandler');<br><br>/**<br>&nbsp;*&nbsp;파일로&nbsp;로그를&nbsp;저장하는&nbsp;로거&nbsp;객체를&nbsp;리턴한다.<br>&nbsp;*&nbsp;Log&nbsp;클래스를&nbsp;직접&nbsp;호출하지&nbsp;말고,&nbsp;일관성&nbsp;있게&nbsp;get_logger()&nbsp;메소드를&nbsp;사용해서<br>&nbsp;*&nbsp;로거&nbsp;객체를&nbsp;얻도록&nbsp;한다.<br>&nbsp;*&nbsp;<br>&nbsp;*&nbsp;LOG_FILENAME&nbsp;상수로&nbsp;지정된&nbsp;파일&nbsp;이름에&nbsp;.yyyymmdd&nbsp;형태로&nbsp;날짜를&nbsp;붙여&nbsp;로그&nbsp;파일을<br>&nbsp;*&nbsp;생성한다.<br>&nbsp;*&nbsp;<br>&nbsp;*&nbsp;@param&nbsp;string&nbsp;$ident&nbsp;로거&nbsp;구분&nbsp;문자열.&nbsp;일반적으로&nbsp;"클래스명.Method명"&nbsp;혹은&nbsp;&nbsp;"function명"<br>&nbsp;*&nbsp;처럼&nbsp;지정하면&nbsp;된다.&nbsp;이&nbsp;파라미터를&nbsp;지정하지&nbsp;않으면&nbsp;항상&nbsp;get_logger를&nbsp;호출한&nbsp;파일의&nbsp;이름으로<br>&nbsp;*&nbsp;지정된다.<br>&nbsp;*&nbsp;@param&nbsp;integer&nbsp;로그&nbsp;레벨을&nbsp;지정한다.&nbsp;PEAR_LOG_XXX&nbsp;형태의&nbsp;상수로&nbsp;정의&nbsp;되어있다.<br>&nbsp;*&nbsp;@return&nbsp;Log&nbsp;로거&nbsp;객체<br>&nbsp;*/<br>function&nbsp;logger($ident&nbsp;=&nbsp;"GlobalLogger",&nbsp;$logLevel&nbsp;=&nbsp;LOG_LEVEL)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;$today_date&nbsp;=&nbsp;date('Ymd',&nbsp;mktime());&nbsp;//&nbsp;오늘날짜&nbsp;yyyymmdd&nbsp;형태<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;$conf&nbsp;=&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'buffering'&nbsp;=&gt;&nbsp;false,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'lineFormat'&nbsp;=&gt;&nbsp;'[%3$s]&nbsp;%2$s&nbsp;%1$s&nbsp;(%5$s&nbsp;%6$s&nbsp;%7$s)&nbsp;%4$s',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'timeFormat'&nbsp;=&gt;&nbsp;'%Y%m%d&nbsp;%H:%M:%S'<br>&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;$logger&nbsp;=&nbsp;&amp;Log::singleton('file',&nbsp;LOG_FILENAME&nbsp;.&nbsp;"."&nbsp;.&nbsp;$today_date,&nbsp;$ident,&nbsp;$conf);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;$mask&nbsp;=&nbsp;Log::UPTO($logLevel);<br>&nbsp;&nbsp;&nbsp;&nbsp;$logger-&gt;setMask($mask);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$logger;<br>}<br><br>/**<br>&nbsp;*&nbsp;PHP&nbsp;기본&nbsp;에러&nbsp;핸들러를&nbsp;변경한다.<br>&nbsp;*/<br>function&nbsp;errorHandler($code,&nbsp;$message,&nbsp;$file,&nbsp;$line)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Map&nbsp;the&nbsp;PHP&nbsp;error&nbsp;to&nbsp;a&nbsp;Log&nbsp;priority.&nbsp;*/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;($code)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_STRICT:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_NOTICE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_NOTICE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_NOTICE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_WARNING:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_WARNING:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_WARNING;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_ERROR:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;E_USER_ERROR:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_ERR;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$priority&nbsp;=&nbsp;PEAR_LOG_WARNING;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;$logger&nbsp;=&nbsp;logger("PHPError",&nbsp;PHP_LOG_LEVEL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;$logger-&gt;log($message&nbsp;.&nbsp;'&nbsp;in&nbsp;'&nbsp;.&nbsp;$file&nbsp;.&nbsp;'&nbsp;at&nbsp;line&nbsp;'&nbsp;.&nbsp;$line,&nbsp;$priority);<br>}<br><br><br>/**<br>&nbsp;*&nbsp;변수를&nbsp;받아서&nbsp;var_export()한&nbsp;결과를&nbsp;문자열로&nbsp;저장하여&nbsp;넘겨준다.<br>&nbsp;*&nbsp;로그&nbsp;메시지로&nbsp;복잡한&nbsp;형태의&nbsp;변수나&nbsp;배열을&nbsp;출력하고&nbsp;싶을&nbsp;때&nbsp;사용한다.<br>&nbsp;*&nbsp;<br>&nbsp;*&nbsp;@param&nbsp;mixed&nbsp;$variable&nbsp;출력할&nbsp;변수<br>&nbsp;*/<br>function&nbsp;var_export_str($variable)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;ob_start();<br>&nbsp;&nbsp;&nbsp;&nbsp;var_export($variable);<br>&nbsp;&nbsp;&nbsp;&nbsp;$logmsg&nbsp;.=&nbsp;ob_get_contents();<br>&nbsp;&nbsp;&nbsp;&nbsp;ob_end_clean();<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$logmsg;<br>}<br>?&gt;<br></blockquote><br>위 logger()메소드는 다음 처럼 간단히 활용할 수 있다.<br><blockquote class="src">&lt;?php<br>//&nbsp;로그레벨&nbsp;설정&nbsp;상수가&nbsp;Log.php에&nbsp;들어&nbsp;있기&nbsp;때문에<br>//&nbsp;로그&nbsp;레벨&nbsp;설정과&nbsp;logger.php보다&nbsp;Log.php를&nbsp;먼저&nbsp;require&nbsp;해줘야&nbsp;한다.<br>require_once&nbsp;'Log.php';<br><br>define('LOG_FILENAME',&nbsp;'C:/Temp/test.log');<br>define('LOG_LEVEL',&nbsp;PEAR_LOG_DEBUG);<br>define('PHP_LOG_LEVEL',&nbsp;PEAR_LOG_WARNING);<br><br>require_once&nbsp;'logger.php';<br><br>echo&nbsp;"Why?&lt;br/&gt;";<br><br>logger()-&gt;log("하하..",&nbsp;PEAR_LOG_INFO);<br>logger()-&gt;debug("허허..&nbsp;이건&nbsp;DEBUG레벨");<br>logger()-&gt;alert("경고야!!");<br>$arr&nbsp;=&nbsp;array("key"&nbsp;=&gt;&nbsp;"value",<br>&nbsp;&nbsp;&nbsp;&nbsp;"array-"&nbsp;=&gt;&nbsp;"var_export_str&nbsp;함수를&nbsp;이용해서&nbsp;감싸서&nbsp;로그를&nbsp;남기세요."<br>);<br>logger()-&gt;info("객체나&nbsp;배열같은&nbsp;변수를&nbsp;로깅&nbsp;하는&nbsp;방법은&nbsp;두가지가&nbsp;있다.");<br>logger()-&gt;info($arr);&nbsp;#&nbsp;이처럼&nbsp;변수를&nbsp;그냥&nbsp;넘기는&nbsp;방법과<br>logger()-&gt;info("배열&nbsp;:&nbsp;"&nbsp;.&nbsp;var_export_str($arr));&nbsp;#&nbsp;이렇게&nbsp;var_export_str()로&nbsp;감싸는&nbsp;방법<br>?&gt;<br></blockquote><br>위를 실행하면 <em>C:\Temp\test.log.오늘날짜</em> 파일로 다음과 같이 로그가 남는다.<br><blockquote class="src">[info]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(C:\test\test.php&nbsp;14&nbsp;(none))&nbsp;하하..<br>[debug]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(C:\test\test.php&nbsp;15&nbsp;(none))&nbsp;허허..&nbsp;이건&nbsp;DEBUG레벨<br>[alert]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(C:\test\test.php&nbsp;16&nbsp;(none))&nbsp;경고야!!<br>[info]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(C:\test\test.php&nbsp;20&nbsp;(none))&nbsp;객체나&nbsp;배열같은&nbsp;변수를&nbsp;로깅&nbsp;하는&nbsp;방법은&nbsp;두가지가&nbsp;있다.<br>[info]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(C:\test\test.php&nbsp;21&nbsp;(none))&nbsp;Array<br>(<br>&nbsp;&nbsp;&nbsp;&nbsp;[key]&nbsp;=&gt;&nbsp;value<br>&nbsp;&nbsp;&nbsp;&nbsp;[array-]&nbsp;=&gt;&nbsp;var_export_str&nbsp;함수를&nbsp;이용해서&nbsp;감싸서&nbsp;로그를&nbsp;남기세요.<br>)<br><br>[info]&nbsp;GlobalLogger&nbsp;20070207&nbsp;18:38:03&nbsp;(E:\Workspace\ServiceCSTool2\test.php&nbsp;22&nbsp;(none))&nbsp;배열&nbsp;:&nbsp;array&nbsp;(<br>&nbsp;&nbsp;'key'&nbsp;=&gt;&nbsp;'value',<br>&nbsp;&nbsp;'array-'&nbsp;=&gt;&nbsp;'var_export_str&nbsp;함수를&nbsp;이용해서&nbsp;감싸서&nbsp;로그를&nbsp;남기세요.',<br>)<br></blockquote><br>tags : 로그 로깅 디버깅 log logging debugging</div>
                        <div class="post-footer">
                            <button class="btn" onclick="button_click();">목록</button>
                        </div>
                    </div>
                </article>
            </main>
        </section>

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

        <script>
            function button_click() {
                if(history.length > 1) {
                    history.back();
                } else {
                    document.location.href = "../../블로그포스트목록.html";
                }
            }
        </script>
    </body>
</html>
